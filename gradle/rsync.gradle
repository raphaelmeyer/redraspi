
class SyncRootfs extends DefaultTask {
  String user = 'pi'
  String host

  @TaskAction
  def run() {
    def console = System.console()
    if(console == null) {
      throw new GradleException('Does not work with daemon, try with option \'--no-daemon\'')
    }
    println ''
    project.exec {
      executable = 'rsync'
      args = [ '-rl', '--delete-after', '--safe-links', "pi@${host}:/{lib,usr}", './rootfs' ]
    }
  }
}

ext.SyncRootfs = SyncRootfs

